# Transform Model

차 종 마다 seat 및 side mirror 위치를 조절하는 수학적 model이다.

초기 차량에서 얻은 설정들을 토대로 사용자 특성값을 추출해내고, 사용자 특성값을 이용하여 새로운 차량에 적용한다.

<p align="center"><img src="img\sequence.JPG"></p>
    -input-
    
    <차량재원>
     페달 ~ 시트를 맨앞으로 당겼을때의 거리
     차량내부 바닥 ~ 시트를 맨아래로 내렸을때의 거리
     사이드미러 중앙 ~ 시트를 맨앞으로 당겼을때 눈위치(사람머리두께를 약 17 ~ 18cm 라고 가정, 차량 옆면과 수평이 되는 거리측정.)
     좌측 사이드미러 중앙 ~ 시트 중앙까지의 거리 (차량 옆면과 수직되는 거리측정.)
     우측 사이드미러 중앙 ~ 시트 중앙까지의 거리 (차량 옆면과 수직되는 거리측정.)
     차량내부 바닥 ~ 대시보드
     차량내부 바닥 ~ 사이드미러 중앙까지의 높이
     대시 ~ 천장
    
    <사용자 특성값>
     사용자가 앉았을때 엉덩이 ~ 눈높이 << 사용자의 키입력으로 부터 받아옴. → 이후 카메라 센서를 이용하여 측정을 자동화 하는 방법이 있음.
    
    <사용자 세팅값>
     초기 차량에서 조정한 시트와 사이드미러의 조정값.
     
    -process-
    1. input값을 토대로 사용자 특성을 추출
     시트x축 : 사용자의 편안한 공간 확보
     시트y축 : 
      / ver 1 : 바닥에서 편안한 공간을 확보한 값을 이용하여 시트조정
      / ver 2 : 대시보드에서 시선이 올라오는 고정값으로 시트조정 
      / ver 3: 대시보드에 사용자 시선이 위치하는 지점의 비율을 고려하여 시트조정.
      / default : 
     사이드미러 좌우,상하 : 
      / 사용자가 미러를 바라봤을때 보이는 시야의 방향을 고려하여 각도 조절. (즉, 사이드 미러에서 반사된 사용자의 시야각)
      / default : 시야각을 90도. 즉, 거울을 정면에서 바라봤을 때 보이는 장면을 볼 수 있게 설정.
    2. 추출된 사용자 특성을 토대로 새로운 차량에 적용.
    3. 새로운 차량에 적용되있던 포지션에서 1,2 에서 구한 포지션을 적용.
    
    -output-
    1. 새로운 차에서의 개인 포지션
    2. 움직일 값



아래의 사진을 이용하여 원리를 설명함.


<p align="center"><img src="img\introduce_position.JPG"></p>




코드에서 사용자 특성을 반영한 변수는 A, B, C, D, E, p_left, p_right, q, hip_to_eye(입력받은 사용자의 키 *  앉은 눈높이 비율) 이고, 차량의 조정에 영향을 주는 실질적 변수는 **A, B,  p_left, p_right, q** 이다.



## 차량에서 사용자특성 추출하기

사용자의 특성을 추출하여 시트조정을 어떻게 할것인지 정한다.

사용자 특성을 계산하기위해서 다음과같이 변수를 설정하였다.



 a_d : 페달 ~ 시트를 맨앞으로 당겼을때의 거리
 
 b_d : 차량내부 바닥 ~ 시트를 맨아래로 내렸을때의 거리
 
 c : 사이드미러 중앙 ~ 시트를 맨앞으로 당겼을때 눈위치(사람머리두께를 약 17 ~ 18cm 라고 가정, 차량 옆면과 수평이 되는 거리측정.)
 
 d_left : 좌측 사이드미러 중앙 ~ 시트 중앙까지의 거리 (차량 옆면과 수직되는 거리측정.)
 
 d_right : 우측 사이드미러 중앙 ~ 시트 중앙까지의 거리 (차량 옆면과 수직되는 거리측정.)
 
 e : 차량내부 바닥 ~ 대시보드
 
 f : 차량내부 바닥 ~ 사이드미러 중앙까지의 높이
 
 g : 대시 ~ 천장



<p align="center"><img src="img\introduce_variable.JPG"></p>
<p align="center"><img src="img\introduce_position_2.JPG"></p>


### 1. 좌석 시트 조정

#### ● 시트 앞뒤

##### model_1

사용자가 편안한 앞뒤 공간값을 계산하여 새로운 차량에서 앞뒤의 편안한 공간을 확보함.

A = 사용자가 편안하다고 느끼는 공간 

<p align="center"><img src="img\A_model1.JPG"></p>
A = a_d + a_u로 사용자의 특성을 계산하고

새로운차량에서 A - a_d를 한값으로 사용자가 움직여야하는거리 a_u를 계산한다.

#### ● 시트 상하

##### model_1

사용자가 편안한 위아래 공간값을 계산하여 새로운 차량에서 상하의 편안한 공간을 확보함.

B = 사용자가 편안하다고 느끼는 공간

<p align="center"><img src="img\B_model1.JPG"></p>

B = b_d + b_u로 사용자의 특성을 계산하고

새로운차량에서 B - b_d를 한값으로 사용자가 움직여야하는거리 b_u를 계산한다.



##### model_2

사용자가 조정한 대시보드에서 사용자 눈높이의 높이 차(절댓값)을 이용하여 새로운 차량에서 대시보드에서의 눈높이 값을 조정함.

B = 조정된 시트에서 대쉬 보드 까지의 높이

<p align="center"><img src="img\B_model2.JPG"></p>

B = e - b_u - b_d로 사용자특성을 계산하고

새로운차량에서 e - B - b_d 를 한값으로 사용자가 움직이는 거리 b_u를 계산한다.

(원래는 대시 보드에서 눈높이를 측정하여 위치를 조정하지만, 대시보드에서의 눈높이는 고정되는 변수이고 기존차량에서 B를 구할때도 더해지고 새로운차량에서 b_u를 구할때도 단순히 더해지므로 굳이 생각해줄 필요가없어진다.)



##### model_3

사용자가 조정한 대시보드에서 사용자 눈높이의 높이 차가 대시보드에서 천장까지의 거리에서 차지하는 비율을 이용하여 새로운 차량에서 대시보드에서 천장까지의 특정비율에 눈높이가 가도록 조정함.

B = 사용자가 시트를 조정 했을때 대시보드에서 사용자 시선이 위치하는 지점의 비율

<p align="center"><img src="img\B_model3.JPG"></p>

B = ( hip_to_eye + b_u + b_d - e ) / g 로 사용자의 특성을 계산하고

새로운 차량에서 B * g + e - b_d - hip_to_eye 를 한값으로 사용자가 움직이는 거리 b_u를 계산한다.



### 2. 사이드 미러조정

#### ● 사이드 좌우

##### 	model_1

사용자가 거울을 바라봐서 반사되서 나온 사용자 시야각을 사용자의 특성이라 생각하고 계산된 사용자의 시야각(p)을 일정하게 고정한 상태에서 좌석시트의 상태를 고려해 일정한 수학적 모델에 적용 후 조정값을 계산하여 조정한다.

C = 사이드미러 중앙 ~ 시트설정후 사용자의 눈위치 (차량 옆면과 수평이 되는 거리)

D_left, D_right = 사이드미러 중앙 ~ 차량시트 중앙까지의 거리

 p_left, p_right = 사용자가 사이드미러 중앙을 바라봤을 때 보이는 시야를 각도로 표현 (C 와 D를 이용하여 구함.)



구하는 방법은 좌측 사이드미러나 우측사이드 미러나 같기때문에 좌측사이드를 기준으로 설명함.

<p align="center"><img src="img\introduce_variable.JPG"></p>
<p align="center"><img src="img\introduce_position_2.JPG"></p>

C = c + a_u

D = d

k = arctan(C / D)

로 설정을 하였다.

여기서 p를 계산하기위해서 다음과 같은 사각형의 내각의 합이 360도를 만족한다는것을 이용하였다.

<p align="center"><img src="img\lr_angle_calculate_1.JPG"></p>
<p align="center"><img src="img\lr_angle_calculate_2.JPG"></p>

그래서 사용자 특성인 p와 자동차 사이드미러의 각도인 lr_angle의 값의 관계는 다음과 같다.

<p align="center"><img src="img\lr_angle_calculate_3.JPG"></p>

그러므로 처음 설정되어있던 사이드미러 각도 lr_angle을 통해서 사용자의 시야각 특성 변수 p의 값을 구해내고, 새로운 차량에서 p의 값을 이용하여 새로 setting 해야되는 자동차의 사이드 미러 각도 lr_angle을 구해낸다. (이때, k값을 구하기위해 사용된 C, D 도 새로운 차량에 맞게 변화시켜줘야한다.)

( + 처음에 default 설정을 선택할 때에는 사용자 시야각 p를 90도로 고정하여 차량이 변화해도 사용자시야각 p가 90도로 고정된 상태로 세팅해준다.)



#### ● 사이드 상하

##### 	model_1

사용자가 거울을 바라봐서 반사되서 나온 사용자 시야각을 사용자의 특성이라 생각하고 계산된 사용자의 시야각을 일정하게 고정한 상태에서 좌석시트의 상태를 고려해 일정한 수학적 모델에 적용 후 조정값을 계산하여 조정한다.

C = 사이드미러 중앙 ~ 시트설정후 사용자의 눈위치 (차량 옆면과 수평이 되는 거리)

E = 사이드미러 중앙 ~ 사용자의 눈높이 ((바닥 ~ 조정된시트의 높이) + (사람의 엉덩이 ~ 눈위치) - (바닥 ~ 미러))

q = 사용자가 사이드미러 중앙을 바라봤을 때 보이는 시야를 각도로 표현 (C와 E를 이용하여 구함.)

<p align="center"><img src="img\ud_angle_calculate_1.JPG"></p>

C = c + a_u

E = b_u + b_d + hip_to_eye - f

j = arctan(C / E)

로 설정하였다.

여기서 q를 계산하기위해서 다음과같은 형태의 도형에서 반사각과 입사각의 성질을 이용하여 q와 ud_angle의 각의 관계를 구해보았다.

<p align="center"><img src="img\ud_angle_calculate_2.JPG"></p>

그래서 사용자 특성인 q와 자동차 사이드미러의 각도인 ud_angle의 값의 관계는 다음과 같다.

<p align="center"><img src="img\ud_angle_calculate_3.JPG"></p>

그러므로 처음 설정되어있던 사이드미러 각도 ud_angle을 통해서 사용자의 시야각 특성 변수 q의 값을 구해내고, 새로운 차량에서 q의 값을 이용하여 새로 setting 해야되는 자동차의 사이드 미러 각도 ud_angle을 구해낸다. (이때, j값을 구하기위해 사용된 C, E 도 새로운 차량에 맞게 변화시켜줘야한다.)
